//////////////////////////////////////////////////////////////////////////////////
// Company: 
// Engineer: 
// 
// Create Date: 10/08/2025 04:29:16 PM
// Design Name: 
// Module Name: exp_from_uv
// Project Name: 
// Target Devices: 
// Tool Versions: 
// Description: 
// 
// Dependencies: 
// 
// Revision:
// Revision 0.01 - File Created
// Additional Comments:
// 
//////////////////////////////////////////////////////////////////////////////////


module exp_from_uv(
    input aclk,
    input arstn,

    input [15:0] S_AXIS_TDATA,
    input S_AXIS_TVALID,
    output S_AXIS_TREADY,

    output [15:0] M_AXIS_TDATA,
    output M_AXIS_TVALID,
    input M_AXIS_TREADY
    );

    reg [15:0] s_axis_tdata;

    always @(posedge aclk or negedge arstn) begin
        if(!arstn) begin
            s_axis_tdata <= 16'b0;
        end

        else if(S_AXIS_TREADY & S_AXIS_TVALID)begin
            s_axis_tdata <= S_AXIS_TDATA;
        end

        else begin
            s_axis_tdata <= s_axis_tdata;
        end
    end

    reg m_axis_tvalid;

    always @(posedge aclk or negedge arstn) begin
        if(!arstn) begin
            m_axis_tvalid <= 1'b0;
        end

        else if(S_AXIS_TREADY & S_AXIS_TVALID) begin
            m_axis_tvalid <= 1'b1;
        end

        else if(M_AXIS_TREADY & M_AXIS_TVALID)begin
            m_axis_tvalid <= 1'b0;
        end

        else begin
            m_axis_tvalid <= m_axis_tvalid;
        end
    end

    assign M_AXIS_TVALID = m_axis_tvalid;


    wire [7:0] frac = s_axis_tdata[7:0];
    wire [7:0] int_value = s_axis_tdata[15:8];

    wire [8:0] power2_v = exp2_func(frac);

    wire [7:0] exp = (int_value < 8'd126) ? (8'd126 - int_value) : 8'b0;

    wire [7:0] exp_result = exp + power2_v[8];

    wire [8:0] frac_shifted = power2_v >> power2_v[8];

    wire [6:0] frac_result = frac_shifted[6:0];


    assign M_AXIS_TDATA = {1'b0, exp_result, frac_result};

    assign S_AXIS_TREADY = !m_axis_tvalid || M_AXIS_TREADY;
    
    function automatic [8:0] exp2_func;
        input [7:0] frac;
        begin
            case (frac)
                8'd  0 : exp2_func = 9'b100000000; // 1.000000
                8'd  1 : exp2_func = 9'b100000000; // 1.002711
                8'd  2 : exp2_func = 9'b100000001; // 1.005430
                8'd  3 : exp2_func = 9'b100000010; // 1.008156
                8'd  4 : exp2_func = 9'b100000010; // 1.010889
                8'd  5 : exp2_func = 9'b100000011; // 1.013630
                8'd  6 : exp2_func = 9'b100000100; // 1.016378
                8'd  7 : exp2_func = 9'b100000100; // 1.019134
                8'd  8 : exp2_func = 9'b100000101; // 1.021897
                8'd  9 : exp2_func = 9'b100000110; // 1.024668
                8'd 10 : exp2_func = 9'b100000111; // 1.027446
                8'd 11 : exp2_func = 9'b100000111; // 1.030232
                8'd 12 : exp2_func = 9'b100001000; // 1.033025
                8'd 13 : exp2_func = 9'b100001001; // 1.035826
                8'd 14 : exp2_func = 9'b100001001; // 1.038634
                8'd 15 : exp2_func = 9'b100001010; // 1.041450
                8'd 16 : exp2_func = 9'b100001011; // 1.044274
                8'd 17 : exp2_func = 9'b100001100; // 1.047105
                8'd 18 : exp2_func = 9'b100001100; // 1.049944
                8'd 19 : exp2_func = 9'b100001101; // 1.052791
                8'd 20 : exp2_func = 9'b100001110; // 1.055645
                8'd 21 : exp2_func = 9'b100001110; // 1.058507
                8'd 22 : exp2_func = 9'b100001111; // 1.061377
                8'd 23 : exp2_func = 9'b100010000; // 1.064255
                8'd 24 : exp2_func = 9'b100010001; // 1.067140
                8'd 25 : exp2_func = 9'b100010001; // 1.070034
                8'd 26 : exp2_func = 9'b100010010; // 1.072935
                8'd 27 : exp2_func = 9'b100010011; // 1.075844
                8'd 28 : exp2_func = 9'b100010100; // 1.078761
                8'd 29 : exp2_func = 9'b100010100; // 1.081686
                8'd 30 : exp2_func = 9'b100010101; // 1.084618
                8'd 31 : exp2_func = 9'b100010110; // 1.087559
                8'd 32 : exp2_func = 9'b100010111; // 1.090508
                8'd 33 : exp2_func = 9'b100010111; // 1.093464
                8'd 34 : exp2_func = 9'b100011000; // 1.096429
                8'd 35 : exp2_func = 9'b100011001; // 1.099402
                8'd 36 : exp2_func = 9'b100011010; // 1.102383
                8'd 37 : exp2_func = 9'b100011010; // 1.105371
                8'd 38 : exp2_func = 9'b100011011; // 1.108368
                8'd 39 : exp2_func = 9'b100011100; // 1.111374
                8'd 40 : exp2_func = 9'b100011101; // 1.114387
                8'd 41 : exp2_func = 9'b100011110; // 1.117408
                8'd 42 : exp2_func = 9'b100011110; // 1.120438
                8'd 43 : exp2_func = 9'b100011111; // 1.123476
                8'd 44 : exp2_func = 9'b100100000; // 1.126522
                8'd 45 : exp2_func = 9'b100100001; // 1.129576
                8'd 46 : exp2_func = 9'b100100001; // 1.132639
                8'd 47 : exp2_func = 9'b100100010; // 1.135709
                8'd 48 : exp2_func = 9'b100100011; // 1.138789
                8'd 49 : exp2_func = 9'b100100100; // 1.141876
                8'd 50 : exp2_func = 9'b100100101; // 1.144972
                8'd 51 : exp2_func = 9'b100100101; // 1.148076
                8'd 52 : exp2_func = 9'b100100110; // 1.151189
                8'd 53 : exp2_func = 9'b100100111; // 1.154310
                8'd 54 : exp2_func = 9'b100101000; // 1.157440
                8'd 55 : exp2_func = 9'b100101001; // 1.160578
                8'd 56 : exp2_func = 9'b100101001; // 1.163725
                8'd 57 : exp2_func = 9'b100101010; // 1.166880
                8'd 58 : exp2_func = 9'b100101011; // 1.170044
                8'd 59 : exp2_func = 9'b100101100; // 1.173216
                8'd 60 : exp2_func = 9'b100101101; // 1.176397
                8'd 61 : exp2_func = 9'b100101101; // 1.179587
                8'd 62 : exp2_func = 9'b100101110; // 1.182785
                8'd 63 : exp2_func = 9'b100101111; // 1.185992
                8'd 64 : exp2_func = 9'b100110000; // 1.189207
                8'd 65 : exp2_func = 9'b100110001; // 1.192431
                8'd 66 : exp2_func = 9'b100110010; // 1.195664
                8'd 67 : exp2_func = 9'b100110010; // 1.198906
                8'd 68 : exp2_func = 9'b100110011; // 1.202157
                8'd 69 : exp2_func = 9'b100110100; // 1.205416
                8'd 70 : exp2_func = 9'b100110101; // 1.208684
                8'd 71 : exp2_func = 9'b100110110; // 1.211961
                8'd 72 : exp2_func = 9'b100110111; // 1.215247
                8'd 73 : exp2_func = 9'b100110111; // 1.218542
                8'd 74 : exp2_func = 9'b100111000; // 1.221846
                8'd 75 : exp2_func = 9'b100111001; // 1.225159
                8'd 76 : exp2_func = 9'b100111010; // 1.228481
                8'd 77 : exp2_func = 9'b100111011; // 1.231811
                8'd 78 : exp2_func = 9'b100111100; // 1.235151
                8'd 79 : exp2_func = 9'b100111101; // 1.238500
                8'd 80 : exp2_func = 9'b100111101; // 1.241858
                8'd 81 : exp2_func = 9'b100111110; // 1.245225
                8'd 82 : exp2_func = 9'b100111111; // 1.248601
                8'd 83 : exp2_func = 9'b101000000; // 1.251986
                8'd 84 : exp2_func = 9'b101000001; // 1.255381
                8'd 85 : exp2_func = 9'b101000010; // 1.258784
                8'd 86 : exp2_func = 9'b101000011; // 1.262197
                8'd 87 : exp2_func = 9'b101000011; // 1.265620
                8'd 88 : exp2_func = 9'b101000100; // 1.269051
                8'd 89 : exp2_func = 9'b101000101; // 1.272492
                8'd 90 : exp2_func = 9'b101000110; // 1.275942
                8'd 91 : exp2_func = 9'b101000111; // 1.279401
                8'd 92 : exp2_func = 9'b101001000; // 1.282870
                8'd 93 : exp2_func = 9'b101001001; // 1.286348
                8'd 94 : exp2_func = 9'b101001010; // 1.289836
                8'd 95 : exp2_func = 9'b101001011; // 1.293333
                8'd 96 : exp2_func = 9'b101001011; // 1.296840
                8'd 97 : exp2_func = 9'b101001100; // 1.300356
                8'd 98 : exp2_func = 9'b101001101; // 1.303881
                8'd 99 : exp2_func = 9'b101001110; // 1.307416
                8'd100 : exp2_func = 9'b101001111; // 1.310961
                8'd101 : exp2_func = 9'b101010000; // 1.314516
                8'd102 : exp2_func = 9'b101010001; // 1.318080
                8'd103 : exp2_func = 9'b101010010; // 1.321653
                8'd104 : exp2_func = 9'b101010011; // 1.325237
                8'd105 : exp2_func = 9'b101010100; // 1.328830
                8'd106 : exp2_func = 9'b101010101; // 1.332433
                8'd107 : exp2_func = 9'b101010110; // 1.336045
                8'd108 : exp2_func = 9'b101010110; // 1.339668
                8'd109 : exp2_func = 9'b101010111; // 1.343300
                8'd110 : exp2_func = 9'b101011000; // 1.346942
                8'd111 : exp2_func = 9'b101011001; // 1.350594
                8'd112 : exp2_func = 9'b101011010; // 1.354256
                8'd113 : exp2_func = 9'b101011011; // 1.357927
                8'd114 : exp2_func = 9'b101011100; // 1.361609
                8'd115 : exp2_func = 9'b101011101; // 1.365301
                8'd116 : exp2_func = 9'b101011110; // 1.369002
                8'd117 : exp2_func = 9'b101011111; // 1.372714
                8'd118 : exp2_func = 9'b101100000; // 1.376436
                8'd119 : exp2_func = 9'b101100001; // 1.380168
                8'd120 : exp2_func = 9'b101100010; // 1.383910
                8'd121 : exp2_func = 9'b101100011; // 1.387662
                8'd122 : exp2_func = 9'b101100100; // 1.391424
                8'd123 : exp2_func = 9'b101100101; // 1.395197
                8'd124 : exp2_func = 9'b101100110; // 1.398980
                8'd125 : exp2_func = 9'b101100111; // 1.402773
                8'd126 : exp2_func = 9'b101101000; // 1.406576
                8'd127 : exp2_func = 9'b101101001; // 1.410390
                8'd128 : exp2_func = 9'b101101010; // 1.414214
                8'd129 : exp2_func = 9'b101101011; // 1.418048
                8'd130 : exp2_func = 9'b101101100; // 1.421893
                8'd131 : exp2_func = 9'b101101100; // 1.425748
                8'd132 : exp2_func = 9'b101101101; // 1.429613
                8'd133 : exp2_func = 9'b101101110; // 1.433489
                8'd134 : exp2_func = 9'b101101111; // 1.437376
                8'd135 : exp2_func = 9'b101110000; // 1.441273
                8'd136 : exp2_func = 9'b101110001; // 1.445181
                8'd137 : exp2_func = 9'b101110010; // 1.449099
                8'd138 : exp2_func = 9'b101110011; // 1.453028
                8'd139 : exp2_func = 9'b101110100; // 1.456968
                8'd140 : exp2_func = 9'b101110101; // 1.460918
                8'd141 : exp2_func = 9'b101110111; // 1.464879
                8'd142 : exp2_func = 9'b101111000; // 1.468850
                8'd143 : exp2_func = 9'b101111001; // 1.472833
                8'd144 : exp2_func = 9'b101111010; // 1.476826
                8'd145 : exp2_func = 9'b101111011; // 1.480830
                8'd146 : exp2_func = 9'b101111100; // 1.484845
                8'd147 : exp2_func = 9'b101111101; // 1.488871
                8'd148 : exp2_func = 9'b101111110; // 1.492908
                8'd149 : exp2_func = 9'b101111111; // 1.496955
                8'd150 : exp2_func = 9'b110000000; // 1.501014
                8'd151 : exp2_func = 9'b110000001; // 1.505084
                8'd152 : exp2_func = 9'b110000010; // 1.509164
                8'd153 : exp2_func = 9'b110000011; // 1.513256
                8'd154 : exp2_func = 9'b110000100; // 1.517359
                8'd155 : exp2_func = 9'b110000101; // 1.521473
                8'd156 : exp2_func = 9'b110000110; // 1.525598
                8'd157 : exp2_func = 9'b110000111; // 1.529734
                8'd158 : exp2_func = 9'b110001000; // 1.533882
                8'd159 : exp2_func = 9'b110001001; // 1.538041
                8'd160 : exp2_func = 9'b110001010; // 1.542211
                8'd161 : exp2_func = 9'b110001011; // 1.546392
                8'd162 : exp2_func = 9'b110001100; // 1.550585
                8'd163 : exp2_func = 9'b110001110; // 1.554789
                8'd164 : exp2_func = 9'b110001111; // 1.559004
                8'd165 : exp2_func = 9'b110010000; // 1.563231
                8'd166 : exp2_func = 9'b110010001; // 1.567470
                8'd167 : exp2_func = 9'b110010010; // 1.571719
                8'd168 : exp2_func = 9'b110010011; // 1.575981
                8'd169 : exp2_func = 9'b110010100; // 1.580254
                8'd170 : exp2_func = 9'b110010101; // 1.584538
                8'd171 : exp2_func = 9'b110010110; // 1.588834
                8'd172 : exp2_func = 9'b110010111; // 1.593142
                8'd173 : exp2_func = 9'b110011000; // 1.597462
                8'd174 : exp2_func = 9'b110011010; // 1.601793
                8'd175 : exp2_func = 9'b110011011; // 1.606136
                8'd176 : exp2_func = 9'b110011100; // 1.610490
                8'd177 : exp2_func = 9'b110011101; // 1.614857
                8'd178 : exp2_func = 9'b110011110; // 1.619235
                8'd179 : exp2_func = 9'b110011111; // 1.623625
                8'd180 : exp2_func = 9'b110100000; // 1.628027
                8'd181 : exp2_func = 9'b110100001; // 1.632441
                8'd182 : exp2_func = 9'b110100011; // 1.636867
                8'd183 : exp2_func = 9'b110100100; // 1.641305
                8'd184 : exp2_func = 9'b110100101; // 1.645755
                8'd185 : exp2_func = 9'b110100110; // 1.650218
                8'd186 : exp2_func = 9'b110100111; // 1.654692
                8'd187 : exp2_func = 9'b110101000; // 1.659178
                8'd188 : exp2_func = 9'b110101001; // 1.663677
                8'd189 : exp2_func = 9'b110101011; // 1.668187
                8'd190 : exp2_func = 9'b110101100; // 1.672710
                8'd191 : exp2_func = 9'b110101101; // 1.677245
                8'd192 : exp2_func = 9'b110101110; // 1.681793
                8'd193 : exp2_func = 9'b110101111; // 1.686353
                8'd194 : exp2_func = 9'b110110000; // 1.690925
                8'd195 : exp2_func = 9'b110110010; // 1.695509
                8'd196 : exp2_func = 9'b110110011; // 1.700106
                8'd197 : exp2_func = 9'b110110100; // 1.704716
                8'd198 : exp2_func = 9'b110110101; // 1.709338
                8'd199 : exp2_func = 9'b110110110; // 1.713972
                8'd200 : exp2_func = 9'b110110111; // 1.718619
                8'd201 : exp2_func = 9'b110111001; // 1.723279
                8'd202 : exp2_func = 9'b110111010; // 1.727951
                8'd203 : exp2_func = 9'b110111011; // 1.732636
                8'd204 : exp2_func = 9'b110111100; // 1.737334
                8'd205 : exp2_func = 9'b110111101; // 1.742044
                8'd206 : exp2_func = 9'b110111111; // 1.746767
                8'd207 : exp2_func = 9'b111000000; // 1.751503
                8'd208 : exp2_func = 9'b111000001; // 1.756252
                8'd209 : exp2_func = 9'b111000010; // 1.761014
                8'd210 : exp2_func = 9'b111000100; // 1.765788
                8'd211 : exp2_func = 9'b111000101; // 1.770576
                8'd212 : exp2_func = 9'b111000110; // 1.775376
                8'd213 : exp2_func = 9'b111000111; // 1.780190
                8'd214 : exp2_func = 9'b111001000; // 1.785017
                8'd215 : exp2_func = 9'b111001010; // 1.789856
                8'd216 : exp2_func = 9'b111001011; // 1.794709
                8'd217 : exp2_func = 9'b111001100; // 1.799575
                8'd218 : exp2_func = 9'b111001101; // 1.804454
                8'd219 : exp2_func = 9'b111001111; // 1.809347
                8'd220 : exp2_func = 9'b111010000; // 1.814252
                8'd221 : exp2_func = 9'b111010001; // 1.819171
                8'd222 : exp2_func = 9'b111010010; // 1.824103
                8'd223 : exp2_func = 9'b111010100; // 1.829049
                8'd224 : exp2_func = 9'b111010101; // 1.834008
                8'd225 : exp2_func = 9'b111010110; // 1.838981
                8'd226 : exp2_func = 9'b111011000; // 1.843967
                8'd227 : exp2_func = 9'b111011001; // 1.848966
                8'd228 : exp2_func = 9'b111011010; // 1.853979
                8'd229 : exp2_func = 9'b111011011; // 1.859006
                8'd230 : exp2_func = 9'b111011101; // 1.864046
                8'd231 : exp2_func = 9'b111011110; // 1.869100
                8'd232 : exp2_func = 9'b111011111; // 1.874168
                8'd233 : exp2_func = 9'b111100001; // 1.879249
                8'd234 : exp2_func = 9'b111100010; // 1.884344
                8'd235 : exp2_func = 9'b111100011; // 1.889453
                8'd236 : exp2_func = 9'b111100101; // 1.894576
                8'd237 : exp2_func = 9'b111100110; // 1.899713
                8'd238 : exp2_func = 9'b111100111; // 1.904863
                8'd239 : exp2_func = 9'b111101000; // 1.910028
                8'd240 : exp2_func = 9'b111101010; // 1.915207
                8'd241 : exp2_func = 9'b111101011; // 1.920399
                8'd242 : exp2_func = 9'b111101100; // 1.925606
                8'd243 : exp2_func = 9'b111101110; // 1.930827
                8'd244 : exp2_func = 9'b111101111; // 1.936062
                8'd245 : exp2_func = 9'b111110000; // 1.941311
                8'd246 : exp2_func = 9'b111110010; // 1.946574
                8'd247 : exp2_func = 9'b111110011; // 1.951852
                8'd248 : exp2_func = 9'b111110101; // 1.957144
                8'd249 : exp2_func = 9'b111110110; // 1.962450
                8'd250 : exp2_func = 9'b111110111; // 1.967771
                8'd251 : exp2_func = 9'b111111001; // 1.973106
                8'd252 : exp2_func = 9'b111111010; // 1.978456
                8'd253 : exp2_func = 9'b111111011; // 1.983820
                8'd254 : exp2_func = 9'b111111101; // 1.989199
                8'd255 : exp2_func = 9'b111111110; // 1.994592
            endcase
        end
    endfunction
endmodule
